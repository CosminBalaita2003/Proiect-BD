Balaita Cosmin-Neculai, grupa 141,  Subiect SQL â€“ Set 1, scema 211
---1A
SELECT C.DATA_PLECARE, E.DENUMIRE, A.NR_INMATRICULARE
FROM EXCURSIE E
JOIN CALENDAR C ON E.ID_EXCURSIE = C.ID_EXCURSIE
JOIN AUTOCAR A ON A.ID_AUTOCAR = C.ID_AUTOCAR
WHERE C.DATA_PLECARE BETWEEN TO_DATE('2023-08-01', 'YYYY-MM-DD') AND TO_DATE('2023-08-31', 'YYYY-MM-DD');

---1B
SELECT E.DENUMIRE, COUNT(C.ID_EXCURSIE) AS NUMAR_PLANIFICARI
FROM EXCURSIE E
         JOIN CALENDAR C ON C.ID_EXCURSIE = E.ID_EXCURSIE
WHERE E.ID_EXCURSIE IN
    (
    ---SUBCERERE CARE SELECTEAZA EXCURSIILE CARE AU AVUT LOC IN 2023
    SELECT E2.ID_EXCURSIE
    FROM EXCURSIE E2
    JOIN CALENDAR C2 on E2.ID_EXCURSIE = C2.ID_EXCURSIE
    WHERE TO_CHAR(C2.DATA_PLECARE, 'YYYY') = '2023'
    )
HAVING COUNT(C.ID_EXCURSIE) >= 2
GROUP BY E.DENUMIRE;

---2
SELECT T.NUME, T.PRENUME, NVL(SUM(C.PRET), 0) AS SUMA
FROM TURIST T
LEFT JOIN REZERVARE R on T.ID_TURIST = R.ID_TURIST
LEFT JOIN CALENDAR C on R.ID_CALENDAR = C.ID_CALENDAR
GROUP BY T.NUME, T.PRENUME
ORDER BY T.NUME;

---3
SELECT E.DENUMIRE, C.DATA_PLECARE, COUNT(R.ID_TURIST) AS TURISTI
FROM EXCURSIE E
JOIN CALENDAR C ON E.ID_EXCURSIE = C.ID_EXCURSIE
JOIN REZERVARE R ON C.ID_CALENDAR = R.ID_CALENDAR
JOIN PROGRAM_GHID PG on C.ID_CALENDAR = PG.ID_CALENDAR
JOIN GHID G ON PG.ID_GHID = G.ID_GHID
JOIN AUTOCAR A2 on A2.ID_AUTOCAR = C.ID_AUTOCAR
WHERE A2.CAPACITATE > 30 ---AFISEAZA ACELASI LUCRU PENTRU >=
HAVING COUNT(DISTINCT G.ID_GHID) <= 2 ---PENTRU <2 NU AFISEAZA NIMIC
GROUP BY E.DENUMIRE, C.DATA_PLECARE;


